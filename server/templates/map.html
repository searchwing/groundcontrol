{% extends "base.html" %}
{% block head %}
<link rel="stylesheet" href="/static/openlayers/ol.css"/>
<script src="/static/jquery/jquery.js"></script>
<script src="/static/openlayers/ol.js"></script>
{% endblock %}
{% block title %}Map{% endblock %}
{% block content %}

<(div id="map"></div>
<script>
console.log('start');

var tiles = new ol.layer.Tile({
    source: new ol.source.XYZ({
        url: "https://cartodb-basemaps-{a-c}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",
    })
});

var view = new ol.View({
    center : ol.proj.transform([13.41, 52.52], 'EPSG:4326', 'EPSG:3857'),
    minZoom:  3,
    maxZoom: 18,
    zoom   :  6, 
});

var position = new ol.Feature();
position.setStyle(new ol.style.Style({
    image: new ol.style.Circle({
        radius: 6,
        fill: new ol.style.Fill({
            color: '#3399CC'
        }),
        stroke: new ol.style.Stroke({
            color: '#fff',
            width: 2
        })
    })
}));

var map = new ol.Map({
    target : 'map',
    view   : view,
    layers : [
        tiles,
    ],
    features: [
        position,
    ],
});

function update(){
    $.getJSON("/api/uav/position", function(data){
        var coord = ol.proj.transform([data["lon"], data["lat"]], "EPSG:4326", "EPSG:3857");
        map.getView().setCenter(coord);
        position.setGeometry(new ol.geom.Point(coord));
    });
}
update();
setInterval(update, 1000);

</script>
{% endblock %}
